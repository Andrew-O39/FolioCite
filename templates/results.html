{% extends "base.html" %}
{% block content %}
<div class="container">
  <h1>Search results</h1>
  <p class="subtitle">
    Select the correct source and confirm its details.
    {% if total_pages and total_pages > 1 %}
      (Page {{ current_page }} of {{ total_pages }})
    {% endif %}
  </p>

  <div class="results">
    {% for item in results %}
      <div class="card result-card">
        <div class="result-layout">
          {% if item.cover_url %}
            <div class="result-cover">
              <img src="{{ item.cover_url }}" alt="Cover for {{ item.title }}">
            </div>
          {% endif %}
          <div class="result-main">
            <h2>{{ item.title }}</h2>
            {% if item.authors %}
              <p><strong>Authors:</strong> {{ item.authors | join(", ") }}</p>
            {% endif %}
            {% if item.entry_type == "book" %}
              {% if item.publisher %}
                <p><strong>Publisher:</strong> {{ item.publisher }}</p>
              {% endif %}
              {% if item.place %}
                <p><strong>Place:</strong> {{ item.place }}</p>
              {% endif %}
            {% else %}
              {% if item.journal %}
                <p><strong>Journal:</strong> {{ item.journal }}</p>
              {% endif %}
              <p>
                {% if item.volume %}<strong>Volume:</strong> {{ item.volume }} {% endif %}
                {% if item.issue %} <strong>Issue:</strong> {{ item.issue }} {% endif %}
                {% if item.pages %} <strong>Pages:</strong> {{ item.pages }} {% endif %}
              </p>
              {% if item.doi %}
                <p><strong>DOI:</strong> {{ item.doi }}</p>
              {% endif %}
            {% endif %}

            <form action="/confirm" method="post" class="inline-form">
              <input type="hidden" name="entry_type" value="{{ item.entry_type }}">
              <input type="hidden" name="title" value="{{ item.title }}">
              <input type="hidden" name="authors" value="{{ item.authors | join('; ') }}">
              <input type="hidden" name="year" value="{{ item.year or '' }}">
              <input type="hidden" name="publisher" value="{{ item.publisher or '' }}">
              <input type="hidden" name="place" value="{{ item.place or '' }}">
              <input type="hidden" name="journal" value="{{ item.journal or '' }}">
              <input type="hidden" name="volume" value="{{ item.volume or '' }}">
              <input type="hidden" name="issue" value="{{ item.issue or '' }}">
              <input type="hidden" name="pages" value="{{ item.pages or '' }}">
              <input type="hidden" name="doi" value="{{ item.doi or '' }}">
              <input type="hidden" name="style" value="{{ style }}">
              <input type="hidden" name="cover_url" value="{{ item.cover_url or '' }}">
              <button type="submit">Select this {{ 'book' if item.entry_type == 'book' else 'article' }}</button>
            </form>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  {# --- Pagination controls --- #}
  {% if total_pages and total_pages > 1 %}
    <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
      <div>
        Page {{ current_page }} of {{ total_pages }}
      </div>
      <div>
        {% if has_prev %}
          <form action="/search" method="post" style="display:inline;">
            <input type="hidden" name="query" value="{{ query }}">
            <input type="hidden" name="style" value="{{ style }}">
            <input type="hidden" name="source_type" value="{{ source_type }}">
            <input type="hidden" name="page" value="{{ current_page - 1 }}">
            <button type="submit">&larr; Previous</button>
          </form>
        {% endif %}

        {% if has_next %}
          <form action="/search" method="post" style="display:inline; margin-left:0.5rem;">
            <input type="hidden" name="query" value="{{ query }}">
            <input type="hidden" name="style" value="{{ style }}">
            <input type="hidden" name="source_type" value="{{ source_type }}">
            <input type="hidden" name="page" value="{{ current_page + 1 }}">
            <button type="submit">Next &rarr;</button>
          </form>
        {% endif %}
      </div>
    </div>
  {% endif %}

  <a href="/" class="back-link">&larr; Start over</a>
</div>
{% endblock %}